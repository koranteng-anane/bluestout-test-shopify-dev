{%- comment -%} FIX #1: Added missing comma after "name": "Featured Products" {%- endcomment -%}
{%- comment -%} FIX #2: Added missing comma after "type": "color" {%- endcomment -%}
{%- comment -%} FIX #3: Added missing comma between { "value": "h2", "label": "H2" } , { "value": "h3", "label": "H3" }{%- endcomment -%}


{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "featured-products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Heading Tag",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" }
      ],
      "default": "h2"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 2,
      "max": 8,
      "step": 1,
      "label": "Number of Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    }
  ],
  "presets": [
    {
      "name": "Featured Products"
    }
  ]
}
{% endschema %}


<div class="featured-products" style="background-color: {{ section.settings.background_color }}">
  <div class="featured-products__container page-width">

{%- comment -%} FIX #4: Heading should only rendered when its not blank {%- endcomment -%}    

{% if section.settings.heading != blank %}
      <{{ section.settings.heading_tag }} class="featured-products__heading">
        {{ section.settings.heading }}
      </{{ section.settings.heading_tag }}>
    {% endif %}

    {% if section.settings.collection != blank %}
      <div class="featured-products__grid">
        {% for product in section.settings.collection.products limit: section.settings.products_count %}
          <div class="featured-products__card">
            
			{%- comment -%} FIX #5: Replaced clickable div with anchor tag {%- endcomment -%}
			
            <a href="{{ product.url }}" class="featured-products__image-link">
              
			  {%- comment -%} FIX #6: Added alt for img {%- endcomment -%}
			  <img 
                src="{{ product.featured_image | image_url: width: 600 }}"
                width="600"
                height="600"
                loading="lazy" alt="{{ product.title }}"
              >
            </a>

            <div class="featured-products__info">
              <div class="featured-products__title">{{ product.title }}</div>
              {%- comment -%} FIX #7: Applied money filter format prices correctly {%- endcomment -%}
              <div class="featured-products__price">
                {% if product.compare_at_price > product.price %}
                  <span class="featured-products__price--sale">
                    {{ product.price | money }}
                  </span>
                  <s>{{ product.compare_at_price | money }}</s>
                {% else %}
                  {{ product.price | money }}
                {% endif %}
              </div>
			
			{%- comment -%} FIX #8: incorrect format for AddtoCart, also variant reference "product.variant.first.id" changed to "product.first_available_variant.id" {%- endcomment -%}	
			
              <form method="post" action="/cart/add">
                <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
                <button type="submit" class="featured-products__button">
                  Add to Cart
                </button>
              </form>
            </div>

          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="featured-products__empty">
        No collection selected. Please choose a collection in the theme editor.
      </div>
    {% endif %}

  </div>
</div>

{% stylesheet %}
.featured-products {
  padding: 60px 0;
}

.featured-products__grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
}

.featured-products__card {
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
}

.featured-products__image-link {
  cursor: pointer;
}

.featured-products__title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
}

.featured-products__button {
  background: #1a1a1a;
  color: #fff;
  padding: 12px 24px;
  text-align: center;
  cursor: pointer;
}

/* {%- comment -%} FIX #8: Added Responsive Behavior {%- endcomment -%} */

@media only screen and (min-width: 768px) {

  .featured-products__grid {
    display: flex;
    scroll-snap-type: x mandatory;
    scroll-snap-align: start;
    gap: 16px;
  }

	.featured-products__card {
		flex: 0 0 80%;
		scroll-snap-align: start;
	}
		
}


@media (min-width: 768px) and (max-width: 1024px) {

  .featured-products__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
  }

  .featured-products__card {
    flex: unset;
  }
}

{% endstylesheet %}